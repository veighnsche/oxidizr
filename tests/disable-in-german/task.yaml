summary: Disable only coreutils under a German locale, leaving sudo-rs enabled
execute: |
  set -euo pipefail

  # Enable German locale (portable across distros)
  export LC_ALL=de_DE.UTF-8
  export LANGUAGE=de_DE.UTF-8
  export LANG=de_DE.UTF-8

  oxidizr-arch enable --yes
  oxidizr-arch disable --yes --experiments coreutils

  # Restore English for assertions
  export LC_ALL=en_GB.UTF-8
  export LANGUAGE=en_GB.UTF-8
  export LANG=en_GB.UTF-8

  # Verify coreutils is removed
  ! pacman -Qi uutils-coreutils >/dev/null 2>&1 || { echo "uutils-coreutils should not be installed"; exit 1; }
  [ ! -L /usr/bin/date ] || { echo "/usr/bin/date should not be a symlink"; exit 1; }
  
  # Verify sudo-rs is still installed
  pacman -Qi sudo-rs >/dev/null 2>&1 || { echo "sudo-rs should be installed"; exit 1; }
  [ -L /usr/bin/sudo ] || { echo "/usr/bin/sudo should be a symlink"; exit 1; }
restore: |
  if [ -z "${CI:-}" ]; then
    oxidizr-arch disable --yes --all || true
  fi
