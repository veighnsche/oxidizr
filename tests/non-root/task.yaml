summary: Non-root execution should fail with explicit error
execute: |
  set -euo pipefail

  # Ensure spread user exists per cloud-config
  output_enable=$(su -s /bin/bash -c "oxidizr-arch enable" spread 2>&1) || true
  echo "--- Captured output for 'enable' ---"
  echo "$output_enable"
  echo "------------------------------------"
  echo "$output_enable" | grep -q 'This command must be run as root' || { echo "Expected root error message not found"; exit 1; }

  output_disable=$(su -s /bin/bash -c "oxidizr-arch disable" spread 2>&1) || true
  echo "--- Captured output for 'disable' ---"
  echo "$output_disable"
  echo "------------------------------------"
  echo "$output_disable" | grep -q 'This command must be run as root' || { echo "Expected root error message not found"; exit 1; }
restore: |
  true
